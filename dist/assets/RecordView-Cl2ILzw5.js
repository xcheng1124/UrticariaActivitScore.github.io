import{_ as X,u as Z,d as k,f as ee,i as te}from"./_plugin-vue_export-helper-CGuNlE4B.js";import{r as p,c as f,o as ae,w as se,a as C,b as s,d as e,e as n,f as i,g as R,h as z,i as h,t as u,j as V,F as B,k as N,n as U,u as Y,s as D}from"./index-CXGi4SA3.js";import{s as oe}from"./function-call-Bmr0OV3M.js";const le={class:"record-view"},ne={class:"date-selector"},ce={class:"date-text"},ie={class:"info-content"},ue={class:"score-buttons"},re=["onClick"],de={class:"score-value"},ve={class:"score-label"},_e={class:"score-buttons"},me=["onClick"],pe={class:"score-value"},fe={class:"score-label"},he={class:"total-score"},we={class:"total-value"},De={class:"score-number"},Se={class:"total-desc"},ye={class:"action-buttons"},ge={__name:"RecordView",setup(be){const r=Z();k().format("YYYY-MM-DD");const d=p([new Date().getFullYear(),new Date().getMonth()+1,new Date().getDate()]),m=p(!1),x=p([]),S=p(!1),l=p({whealScore:0,itchScore:0,note:""}),$=[{value:0,label:"无"},{value:1,label:"轻度"},{value:2,label:"中度"},{value:3,label:"重度"}],F=new Date(2020,0,1),M=new Date,c=f(()=>`${d.value[0]}-${String(d.value[1]).padStart(2,"0")}-${String(d.value[2]).padStart(2,"0")}`),T=f(()=>ee(c.value)),y=f(()=>te(c.value)),j=f(()=>l.value.whealScore+l.value.itchScore),g=f(()=>!!r.getRecordByDate(c.value)),v=()=>{const o=r.getRecordByDate(c.value);o?l.value={whealScore:o.whealScore,itchScore:o.itchScore,note:o.note||""}:l.value={whealScore:0,itchScore:0,note:""}},E=()=>{m.value=!1,r.setCurrentDate(c.value),v()},O=()=>{const o=k(c.value).subtract(1,"day");d.value=[o.year(),o.month()+1,o.date()],r.setCurrentDate(c.value),v()},P=()=>{if(!y.value){const o=k(c.value).add(1,"day");d.value=[o.year(),o.month()+1,o.date()],r.setCurrentDate(c.value),v()}},I=async()=>{S.value=!0;try{r.saveOrUpdateRecord({date:c.value,whealScore:l.value.whealScore,itchScore:l.value.itchScore,note:l.value.note})?D({message:g.value?"更新成功":"保存成功",icon:"success"}):D({message:"保存失败，请重试",icon:"fail"})}finally{S.value=!1}},L=async()=>{try{await oe({title:"提示",message:"确定要删除这条记录吗？"}),r.removeRecord(c.value)?(D({message:"删除成功",icon:"success"}),v()):D({message:"删除失败",icon:"fail"})}catch{}};return ae(()=>{v()}),se(()=>c.value,()=>{v()}),(o,t)=>{const w=i("van-button"),q=i("van-tag"),b=i("van-cell"),_=i("van-cell-group"),A=i("van-divider"),G=i("van-collapse-item"),H=i("van-collapse"),J=i("van-field"),K=i("van-date-picker"),Q=i("van-popup");return h(),C("div",le,[s(_,{inset:"",class:"date-section"},{default:n(()=>[s(b,{center:""},{title:n(()=>[e("div",ne,[s(w,{icon:"arrow-left",size:"small",onClick:O}),e("div",{class:"date-display",onClick:t[0]||(t[0]=a=>m.value=!0)},[e("div",ce,u(T.value),1),y.value?(h(),R(q,{key:0,type:"success"},{default:n(()=>[...t[6]||(t[6]=[V("今天",-1)])]),_:1})):z("",!0)]),s(w,{icon:"arrow",size:"small",onClick:P,disabled:y.value},null,8,["disabled"])])]),_:1})]),_:1}),s(_,{inset:"",class:"info-section"},{default:n(()=>[s(H,{modelValue:x.value,"onUpdate:modelValue":t[1]||(t[1]=a=>x.value=a),title:"评分标准说明"},{default:n(()=>[s(G,{name:"1",title:"评分标准说明",icon:"info-o"},{default:n(()=>[e("div",ie,[t[7]||(t[7]=e("div",{class:"info-item"},[e("div",{class:"info-title"},"风团数量："),e("div",{class:"info-desc"},[e("p",null,"• 无(0分)"),e("p",null,"• 轻度(1分)：<20个/24h"),e("p",null,"• 中度(2分)：20-50个/24h"),e("p",null,"• 重度(3分)：>50个/24h或大片融合")])],-1)),s(A),t[8]||(t[8]=e("div",{class:"info-item"},[e("div",{class:"info-title"},"瘙痒程度："),e("div",{class:"info-desc"},[e("p",null,"• 无(0分)"),e("p",null,"• 轻度(1分)：存在，但不引起烦躁或麻烦"),e("p",null,"• 中度(2分)：有麻烦，但不影响日常生活及睡眠"),e("p",null,"• 重度(3分)：严重瘙痒，明显影响日常生活及睡眠")])],-1))])]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(_,{inset:"",class:"score-section"},{default:n(()=>[s(b,{title:"风团数量",icon:"notes-o"}),e("div",ue,[(h(),C(B,null,N($,a=>e("div",{key:`wheal-${a.value}`,class:U(["score-btn",{active:l.value.whealScore===a.value}]),onClick:W=>l.value.whealScore=a.value},[e("div",de,u(a.value),1),e("div",ve,u(a.label),1)],10,re)),64))])]),_:1}),s(_,{inset:"",class:"score-section"},{default:n(()=>[s(b,{title:"瘙痒程度",icon:"fire-o"}),e("div",_e,[(h(),C(B,null,N($,a=>e("div",{key:`itch-${a.value}`,class:U(["score-btn",{active:l.value.itchScore===a.value}]),onClick:W=>l.value.itchScore=a.value},[e("div",pe,u(a.value),1),e("div",fe,u(a.label),1)],10,me)),64))])]),_:1}),s(_,{inset:"",class:"total-section"},{default:n(()=>[e("div",he,[t[10]||(t[10]=e("div",{class:"total-label"},"每日总分",-1)),e("div",we,[e("span",De,u(j.value),1),t[9]||(t[9]=e("span",{class:"score-unit"},"分",-1))]),e("div",Se,"风团 "+u(l.value.whealScore)+" + 瘙痒 "+u(l.value.itchScore),1)])]),_:1}),s(_,{inset:"",class:"note-section"},{default:n(()=>[s(J,{modelValue:l.value.note,"onUpdate:modelValue":t[2]||(t[2]=a=>l.value.note=a),rows:"3",autosize:"",type:"textarea",maxlength:"200",placeholder:"记录今日特殊情况、症状描述等（可选）","show-word-limit":""},null,8,["modelValue"])]),_:1}),e("div",ye,[s(w,{type:"primary",size:"large",block:"",loading:S.value,onClick:I},{default:n(()=>[V(u(g.value?"更新记录":"保存记录"),1)]),_:1},8,["loading"]),g.value?(h(),R(w,{key:0,type:"danger",size:"large",block:"",onClick:L},{default:n(()=>[...t[11]||(t[11]=[V(" 删除记录 ",-1)])]),_:1})):z("",!0)]),s(Q,{show:m.value,"onUpdate:show":t[5]||(t[5]=a=>m.value=a),position:"bottom"},{default:n(()=>[s(K,{modelValue:d.value,"onUpdate:modelValue":t[3]||(t[3]=a=>d.value=a),title:"选择日期","min-date":Y(F),"max-date":Y(M),onConfirm:E,onCancel:t[4]||(t[4]=a=>m.value=!1)},null,8,["modelValue","min-date","max-date"])]),_:1},8,["show"])])}}},xe=X(ge,[["__scopeId","data-v-a0755c84"]]);export{xe as default};
