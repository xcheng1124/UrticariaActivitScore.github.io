import{g as q,_ as W,d as h,u as X,f as Y,i as Z}from"./_plugin-vue_export-helper-CGuNlE4B.js";import{r as O,c as $,a as C,b as s,d as t,e as a,f as r,g as B,F as ee,k as te,i as _,t as d,h as E,j as u,s as x}from"./index-CXGi4SA3.js";import{s as se}from"./function-call-Bmr0OV3M.js";var g={exports:{}},oe=g.exports,U;function ae(){return U||(U=1,(function(w,f){(function(v,i){w.exports=i()})(oe,(function(){return function(v,i){i.prototype.isSameOrAfter=function(n,c){return this.isSame(n,c)||this.isAfter(n,c)}}}))})(g)),g.exports}var ne=ae();const le=q(ne);var b={exports:{}},ie=b.exports,F;function re(){return F||(F=1,(function(w,f){(function(v,i){w.exports=i()})(ie,(function(){return function(v,i){i.prototype.isSameOrBefore=function(n,c){return this.isSame(n,c)||this.isBefore(n,c)}}}))})(b)),b.exports}var de=re();const ue=q(de),ce={class:"history-view"},ve={class:"stats-grid"},me={class:"stat-item"},pe={class:"stat-value"},fe={class:"stat-item"},_e={class:"stat-value"},Se={class:"stat-item"},we={class:"stat-value"},ye={class:"stat-item"},he={class:"stat-value"},xe={class:"record-list"},ge={class:"record-date"},be={class:"date-text"},Ve={class:"record-details"},ke={class:"detail-row"},Oe={class:"detail-row"},Ce={key:0,class:"detail-row note-row"},Be={class:"record-score"},Ae={class:"total-score"},De={class:"edit-popup"},Re={class:"popup-header"},$e={class:"popup-content"},Ee={class:"edit-total"},Ue={__name:"HistoryView",setup(w){h.extend(le),h.extend(ue);const f=X(),v=O("all"),i=O(!1),n=O({date:"",whealScore:0,itchScore:0,note:""}),c=$(()=>f.statistics),A=$(()=>{const l=f.sortedRecords;if(v.value==="all")return l;const e=h();let p;return v.value==="week"?p=e.subtract(7,"day"):v.value==="month"&&(p=e.subtract(30,"day")),l.filter(S=>h(S.date).isSameOrAfter(p,"day"))}),I=l=>Y(l),z=l=>Z(l),D=l=>["无","轻度","中度","重度"][l]||"未知",N=()=>{},T=l=>{n.value={date:l.date,whealScore:l.whealScore,itchScore:l.itchScore,note:l.note||""},i.value=!0},j=()=>{f.saveOrUpdateRecord({date:n.value.date,whealScore:n.value.whealScore,itchScore:n.value.itchScore,note:n.value.note})?(x({message:"更新成功",icon:"success"}),i.value=!1):x({message:"更新失败",icon:"fail"})},H=async l=>{try{await se({title:"提示",message:"确定要删除这条记录吗？"}),f.removeRecord(l)?x({message:"删除成功",icon:"success"}):x({message:"删除失败",icon:"fail"})}catch{}};return(l,e)=>{const p=r("van-cell-group"),S=r("van-tab"),L=r("van-tabs"),P=r("van-empty"),G=r("van-tag"),V=r("van-icon"),J=r("van-cell"),k=r("van-button"),K=r("van-swipe-cell"),y=r("van-field"),m=r("van-radio"),R=r("van-radio-group"),M=r("van-popup");return _(),C("div",ce,[s(p,{inset:"",class:"stats-section"},{default:a(()=>[t("div",ve,[t("div",me,[t("div",pe,d(c.value.recordedDays),1),e[7]||(e[7]=t("div",{class:"stat-label"},"记录天数",-1))]),t("div",fe,[t("div",_e,d(c.value.avgScore),1),e[8]||(e[8]=t("div",{class:"stat-label"},"平均分",-1))]),t("div",Se,[t("div",we,d(c.value.maxScore),1),e[9]||(e[9]=t("div",{class:"stat-label"},"最高分",-1))]),t("div",ye,[t("div",he,d(c.value.minScore),1),e[10]||(e[10]=t("div",{class:"stat-label"},"最低分",-1))])])]),_:1}),s(p,{inset:"",class:"filter-section"},{default:a(()=>[s(L,{active:v.value,"onUpdate:active":e[0]||(e[0]=o=>v.value=o),onChange:N},{default:a(()=>[s(S,{title:"全部",name:"all"}),s(S,{title:"本周",name:"week"}),s(S,{title:"本月",name:"month"})]),_:1},8,["active"])]),_:1}),t("div",xe,[A.value.length===0?(_(),B(P,{key:0,description:"暂无记录数据",image:"search"})):(_(!0),C(ee,{key:1},te(A.value,o=>(_(),B(p,{inset:"",key:o.date,class:"record-item"},{default:a(()=>[s(K,null,{right:a(()=>[s(k,{square:"",type:"danger",text:"删除",class:"delete-button",onClick:Q=>H(o.date)},null,8,["onClick"])]),default:a(()=>[s(J,{onClick:Q=>T(o)},{title:a(()=>[t("div",ge,[t("span",be,d(I(o.date)),1),z(o.date)?(_(),B(G,{key:0,type:"success",size:"medium"},{default:a(()=>[...e[11]||(e[11]=[u(" 今天 ",-1)])]),_:1})):E("",!0)])]),label:a(()=>[t("div",Ve,[t("div",ke,[s(V,{name:"notes-o"}),t("span",null,"风团数量: "+d(o.whealScore)+"分 ("+d(D(o.whealScore))+")",1)]),t("div",Oe,[s(V,{name:"fire-o"}),t("span",null,"瘙痒程度: "+d(o.itchScore)+"分 ("+d(D(o.itchScore))+")",1)]),o.note?(_(),C("div",Ce,[s(V,{name:"chat-o"}),t("span",null,d(o.note),1)])):E("",!0)])]),value:a(()=>[t("div",Be,[t("div",Ae,d(o.totalScore),1),e[12]||(e[12]=t("div",{class:"score-label"},"总分",-1))])]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),s(M,{show:i.value,"onUpdate:show":e[6]||(e[6]=o=>i.value=o),position:"bottom",round:""},{default:a(()=>[t("div",De,[t("div",Re,[s(k,{type:"primary",text:"",onClick:e[1]||(e[1]=o=>i.value=!1)},{default:a(()=>[...e[13]||(e[13]=[u(" 取消 ",-1)])]),_:1}),e[15]||(e[15]=t("div",{class:"popup-title"},"编辑记录",-1)),s(k,{type:"primary",text:"",onClick:j},{default:a(()=>[...e[14]||(e[14]=[u(" 保存 ",-1)])]),_:1})]),t("div",$e,[s(y,{modelValue:n.value.date,"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.date=o),label:"日期",readonly:"",disabled:""},null,8,["modelValue"]),s(y,{label:"风团数量"},{input:a(()=>[s(R,{modelValue:n.value.whealScore,"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.whealScore=o),direction:"horizontal"},{default:a(()=>[s(m,{name:0},{default:a(()=>[...e[16]||(e[16]=[u("无",-1)])]),_:1}),s(m,{name:1},{default:a(()=>[...e[17]||(e[17]=[u("轻度",-1)])]),_:1}),s(m,{name:2},{default:a(()=>[...e[18]||(e[18]=[u("中度",-1)])]),_:1}),s(m,{name:3},{default:a(()=>[...e[19]||(e[19]=[u("重度",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(y,{label:"瘙痒程度"},{input:a(()=>[s(R,{modelValue:n.value.itchScore,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.itchScore=o),direction:"horizontal"},{default:a(()=>[s(m,{name:0},{default:a(()=>[...e[20]||(e[20]=[u("无",-1)])]),_:1}),s(m,{name:1},{default:a(()=>[...e[21]||(e[21]=[u("轻度",-1)])]),_:1}),s(m,{name:2},{default:a(()=>[...e[22]||(e[22]=[u("中度",-1)])]),_:1}),s(m,{name:3},{default:a(()=>[...e[23]||(e[23]=[u("重度",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(y,{modelValue:n.value.note,"onUpdate:modelValue":e[5]||(e[5]=o=>n.value.note=o),rows:"2",autosize:"",type:"textarea",maxlength:"200",placeholder:"备注（可选）","show-word-limit":""},null,8,["modelValue"]),t("div",Ee," 总分："+d(n.value.whealScore+n.value.itchScore)+" 分 ",1)])])]),_:1},8,["show"])])}}},ze=W(Ue,[["__scopeId","data-v-f2ae87ff"]]);export{ze as default};
