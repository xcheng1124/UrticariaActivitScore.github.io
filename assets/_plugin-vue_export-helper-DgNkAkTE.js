import{D as st,r as et,c as F}from"./index-GaIkwbhd.js";function ot(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var tt={exports:{}},at=tt.exports,rt;function ct(){return rt||(rt=1,(function(n,u){(function(d,p){n.exports=p()})(at,(function(){var d=1e3,p=6e4,D=36e5,x="millisecond",R="second",T="minute",A="hour",w="day",U="week",Y="month",G="quarter",j="year",C="date",K="Invalid Date",i=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,f=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,S={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(o){var r=["th","st","nd","rd"],t=o%100;return"["+o+(r[(t-20)%10]||r[t]||r[0])+"]"}},y=function(o,r,t){var s=String(o);return!s||s.length>=r?o:""+Array(r+1-s.length).join(t)+o},V={s:y,z:function(o){var r=-o.utcOffset(),t=Math.abs(r),s=Math.floor(t/60),e=t%60;return(r<=0?"+":"-")+y(s,2,"0")+":"+y(e,2,"0")},m:function o(r,t){if(r.date()<t.date())return-o(t,r);var s=12*(t.year()-r.year())+(t.month()-r.month()),e=r.clone().add(s,Y),a=t-e<0,c=r.clone().add(s+(a?-1:1),Y);return+(-(s+(t-e)/(a?e-c:c-e))||0)},a:function(o){return o<0?Math.ceil(o)||0:Math.floor(o)},p:function(o){return{M:Y,y:j,w:U,d:w,D:C,h:A,m:T,s:R,ms:x,Q:G}[o]||String(o||"").toLowerCase().replace(/s$/,"")},u:function(o){return o===void 0}},L="en",g={};g[L]=S;var W="$isDayjsObject",Z=function(o){return o instanceof _||!(!o||!o[W])},N=function o(r,t,s){var e;if(!r)return L;if(typeof r=="string"){var a=r.toLowerCase();g[a]&&(e=a),t&&(g[a]=t,e=a);var c=r.split("-");if(!e&&c.length>1)return o(c[0])}else{var h=r.name;g[h]=r,e=h}return!s&&e&&(L=e),e||!s&&L},m=function(o,r){if(Z(o))return o.clone();var t=typeof r=="object"?r:{};return t.date=o,t.args=arguments,new _(t)},l=V;l.l=N,l.i=Z,l.w=function(o,r){return m(o,{locale:r.$L,utc:r.$u,x:r.$x,$offset:r.$offset})};var _=(function(){function o(t){this.$L=N(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[W]=!0}var r=o.prototype;return r.parse=function(t){this.$d=(function(s){var e=s.date,a=s.utc;if(e===null)return new Date(NaN);if(l.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){var c=e.match(i);if(c){var h=c[2]-1||0,$=(c[7]||"0").substring(0,3);return a?new Date(Date.UTC(c[1],h,c[3]||1,c[4]||0,c[5]||0,c[6]||0,$)):new Date(c[1],h,c[3]||1,c[4]||0,c[5]||0,c[6]||0,$)}}return new Date(e)})(t),this.init()},r.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},r.$utils=function(){return l},r.isValid=function(){return this.$d.toString()!==K},r.isSame=function(t,s){var e=m(t);return this.startOf(s)<=e&&e<=this.endOf(s)},r.isAfter=function(t,s){return m(t)<this.startOf(s)},r.isBefore=function(t,s){return this.endOf(s)<m(t)},r.$g=function(t,s,e){return l.u(t)?this[s]:this.set(e,t)},r.unix=function(){return Math.floor(this.valueOf()/1e3)},r.valueOf=function(){return this.$d.getTime()},r.startOf=function(t,s){var e=this,a=!!l.u(s)||s,c=l.p(t),h=function(J,O){var I=l.w(e.$u?Date.UTC(e.$y,O,J):new Date(e.$y,O,J),e);return a?I:I.endOf(w)},$=function(J,O){return l.w(e.toDate()[J].apply(e.toDate("s"),(a?[0,0,0,0]:[23,59,59,999]).slice(O)),e)},v=this.$W,M=this.$M,b=this.$D,E="set"+(this.$u?"UTC":"");switch(c){case j:return a?h(1,0):h(31,11);case Y:return a?h(1,M):h(0,M+1);case U:var H=this.$locale().weekStart||0,q=(v<H?v+7:v)-H;return h(a?b-q:b+(6-q),M);case w:case C:return $(E+"Hours",0);case A:return $(E+"Minutes",1);case T:return $(E+"Seconds",2);case R:return $(E+"Milliseconds",3);default:return this.clone()}},r.endOf=function(t){return this.startOf(t,!1)},r.$set=function(t,s){var e,a=l.p(t),c="set"+(this.$u?"UTC":""),h=(e={},e[w]=c+"Date",e[C]=c+"Date",e[Y]=c+"Month",e[j]=c+"FullYear",e[A]=c+"Hours",e[T]=c+"Minutes",e[R]=c+"Seconds",e[x]=c+"Milliseconds",e)[a],$=a===w?this.$D+(s-this.$W):s;if(a===Y||a===j){var v=this.clone().set(C,1);v.$d[h]($),v.init(),this.$d=v.set(C,Math.min(this.$D,v.daysInMonth())).$d}else h&&this.$d[h]($);return this.init(),this},r.set=function(t,s){return this.clone().$set(t,s)},r.get=function(t){return this[l.p(t)]()},r.add=function(t,s){var e,a=this;t=Number(t);var c=l.p(s),h=function(M){var b=m(a);return l.w(b.date(b.date()+Math.round(M*t)),a)};if(c===Y)return this.set(Y,this.$M+t);if(c===j)return this.set(j,this.$y+t);if(c===w)return h(1);if(c===U)return h(7);var $=(e={},e[T]=p,e[A]=D,e[R]=d,e)[c]||1,v=this.$d.getTime()+t*$;return l.w(v,this)},r.subtract=function(t,s){return this.add(-1*t,s)},r.format=function(t){var s=this,e=this.$locale();if(!this.isValid())return e.invalidDate||K;var a=t||"YYYY-MM-DDTHH:mm:ssZ",c=l.z(this),h=this.$H,$=this.$m,v=this.$M,M=e.weekdays,b=e.months,E=e.meridiem,H=function(O,I,z,X){return O&&(O[I]||O(s,a))||z[I].slice(0,X)},q=function(O){return l.s(h%12||12,O,"0")},J=E||function(O,I,z){var X=O<12?"AM":"PM";return z?X.toLowerCase():X};return a.replace(f,(function(O,I){return I||(function(z){switch(z){case"YY":return String(s.$y).slice(-2);case"YYYY":return l.s(s.$y,4,"0");case"M":return v+1;case"MM":return l.s(v+1,2,"0");case"MMM":return H(e.monthsShort,v,b,3);case"MMMM":return H(b,v);case"D":return s.$D;case"DD":return l.s(s.$D,2,"0");case"d":return String(s.$W);case"dd":return H(e.weekdaysMin,s.$W,M,2);case"ddd":return H(e.weekdaysShort,s.$W,M,3);case"dddd":return M[s.$W];case"H":return String(h);case"HH":return l.s(h,2,"0");case"h":return q(1);case"hh":return q(2);case"a":return J(h,$,!0);case"A":return J(h,$,!1);case"m":return String($);case"mm":return l.s($,2,"0");case"s":return String(s.$s);case"ss":return l.s(s.$s,2,"0");case"SSS":return l.s(s.$ms,3,"0");case"Z":return c}return null})(O)||c.replace(":","")}))},r.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},r.diff=function(t,s,e){var a,c=this,h=l.p(s),$=m(t),v=($.utcOffset()-this.utcOffset())*p,M=this-$,b=function(){return l.m(c,$)};switch(h){case j:a=b()/12;break;case Y:a=b();break;case G:a=b()/3;break;case U:a=(M-v)/6048e5;break;case w:a=(M-v)/864e5;break;case A:a=M/D;break;case T:a=M/p;break;case R:a=M/d;break;default:a=M}return e?a:l.a(a)},r.daysInMonth=function(){return this.endOf(Y).$D},r.$locale=function(){return g[this.$L]},r.locale=function(t,s){if(!t)return this.$L;var e=this.clone(),a=N(t,s,!0);return a&&(e.$L=a),e},r.clone=function(){return l.w(this.$d,this)},r.toDate=function(){return new Date(this.valueOf())},r.toJSON=function(){return this.isValid()?this.toISOString():null},r.toISOString=function(){return this.$d.toISOString()},r.toString=function(){return this.$d.toUTCString()},o})(),Q=_.prototype;return m.prototype=Q,[["$ms",x],["$s",R],["$m",T],["$H",A],["$W",w],["$M",Y],["$y",j],["$D",C]].forEach((function(o){Q[o[1]]=function(r){return this.$g(r,o[0],o[1])}})),m.extend=function(o,r){return o.$i||(o(r,_,m),o.$i=!0),m},m.locale=N,m.isDayjs=Z,m.unix=function(o){return m(1e3*o)},m.en=g[L],m.Ls=g,m.p={},m}))})(tt)),tt.exports}var it=ct();const k=ot(it),P="uas7_records";function B(){try{const n=localStorage.getItem(P);return n?JSON.parse(n):[]}catch(n){return console.error("获取记录失败:",n),[]}}function ut(n){try{const u=B(),d=u.findIndex(p=>p.date===n.date);return d!==-1?u[d]={...n,updateTime:Date.now()}:u.push({...n,recordId:`record_${Date.now()}`,createTime:Date.now(),updateTime:Date.now()}),localStorage.setItem(P,JSON.stringify(u)),!0}catch(u){return console.error("保存记录失败:",u),!1}}function lt(n){return B().find(d=>d.date===n)||null}function dt(n){try{const d=B().filter(p=>p.date!==n);return localStorage.setItem(P,JSON.stringify(d)),!0}catch(u){return console.error("删除记录失败:",u),!1}}function ft(){const n=B();return JSON.stringify(n,null,2)}function ht(){const n=B();if(n.length===0)return"";const u=["日期","风团数量评分","瘙痒程度评分","每日总分","备注"],d=n.map(D=>[D.date,D.whealScore,D.itchScore,D.totalScore,D.note||""]);return[u.join(","),...d.map(D=>D.join(","))].join(`
`)}function mt(n){try{const u=JSON.parse(n);if(!Array.isArray(u))throw new Error("无效的数据格式");return localStorage.setItem(P,JSON.stringify(u)),!0}catch(u){return console.error("导入数据失败:",u),!1}}function $t(){try{return localStorage.removeItem(P),!0}catch(n){return console.error("清空数据失败:",n),!1}}function nt(n,u,d="text/plain"){const p=new Blob([n],{type:d}),D=URL.createObjectURL(p),x=document.createElement("a");x.href=D,x.download=u,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(D)}function yt(){return k().format("YYYY-MM-DD")}function Dt(n){const u=[];for(let d=n-1;d>=0;d--)u.push(k().subtract(d,"day").format("YYYY-MM-DD"));return u}function vt(n){const u=k(n),d=["周日","周一","周二","周三","周四","周五","周六"];return`${u.format("M月D日")} ${d[u.day()]}`}function pt(n){return k(n).isSame(k(),"day")}const gt=st("record",()=>{const n=et([]),u=et(yt()),d=et(!1),p=F(()=>n.value.find(i=>i.date===u.value)||null),D=F(()=>[...n.value].sort((i,f)=>k(f.date).valueOf()-k(i.date).valueOf())),x=F(()=>{if(n.value.length===0)return{totalDays:0,avgScore:0,maxScore:0,minScore:0,recordedDays:0};const i=n.value.map(S=>S.totalScore),f=i.reduce((S,y)=>S+y,0);return{totalDays:n.value.length,avgScore:(f/n.value.length).toFixed(1),maxScore:Math.max(...i),minScore:Math.min(...i),recordedDays:n.value.length}}),R=F(()=>{const i=[],f=D.value.map(g=>g.date).sort();if(f.length===0)return i;const S=f[0],y=k(S),V=k(f[f.length-1]).diff(y,"day")+1,L=Math.ceil(V/7);for(let g=0;g<L;g++){const W=y.add(g*7,"day"),Z=W.add(6,"day"),N=[];for(let _=0;_<7;_++)N.push(W.add(_,"day").format("YYYY-MM-DD"));const m=n.value.filter(_=>N.includes(_.date)),l=m.reduce((_,Q)=>_+Q.totalScore,0);i.push({week:g+1,label:`第${g*7+1}-${g*7+7}天`,startDate:W.format("YYYY-MM-DD"),endDate:Z.format("YYYY-MM-DD"),score:l,recordedDays:m.length})}return i}),T=F(()=>(i,f)=>n.value.filter(S=>{const y=k(S.date);return y.isSameOrAfter(i)&&y.isSameOrBefore(f)})),A=F(()=>(i=7)=>Dt(i).map(S=>{const y=n.value.find(V=>V.date===S);return{date:S,whealScore:y?.whealScore||0,itchScore:y?.itchScore||0,totalScore:y?.totalScore||0,hasRecord:!!y}})),w=()=>{d.value=!0;try{n.value=B()}finally{d.value=!1}},U=i=>{const f=i.whealScore+i.itchScore,S={date:i.date,whealScore:i.whealScore,itchScore:i.itchScore,totalScore:f,note:i.note||""},y=ut(S);return y&&w(),y},Y=i=>{const f=dt(i);return f&&w(),f},G=i=>{u.value=i},j=(i="json")=>{try{if(i==="json"){const f=ft(),S=`uas7_records_${k().format("YYYYMMDD")}.json`;nt(f,S,"application/json")}else if(i==="csv"){const f=ht(),S=`uas7_records_${k().format("YYYYMMDD")}.csv`;nt(f,S,"text/csv")}return!0}catch(f){return console.error("导出失败:",f),!1}},C=i=>{const f=mt(i);return f&&w(),f},K=()=>{const i=$t();return i&&(n.value=[]),i};return w(),{records:n,currentDate:u,loading:d,currentRecord:p,sortedRecords:D,statistics:x,uas7Scores:R,getRecordsByDateRange:T,getTrendData:A,loadRecords:w,saveOrUpdateRecord:U,removeRecord:Y,setCurrentDate:G,exportData:j,importData:C,clearAll:K,getRecordByDate:lt}}),Mt=(n,u)=>{const d=n.__vccOpts||n;for(const[p,D]of u)d[p]=D;return d};export{Mt as _,k as d,vt as f,ot as g,pt as i,gt as u};
